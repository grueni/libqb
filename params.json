{"name":"Libqb","note":"Don't delete this file! It's used internally to help with page regeneration.","tagline":"libqb is a library providing high performance logging, tracing, ipc, and poll.","body":"# grueni/libqb\r\n\r\n## What is grueni/libqb?\r\nThis site contains informations about compiling libqb for Solaris 11 and OpenIndiana.\r\nLook here for [compiling](http://grueni.github.com/libqb) of the complete Corosync suite.\r\n\r\n## For more information about libqb look at:\r\n* [wiki of libqb](https://github.com/asalkeld/libqb/wiki)\r\n\r\n## Dependencies\r\n* Solaris 11U7\r\n* csw\r\n* additional packages from the Solaris repository\r\n\r\n## Source Control (GIT)\r\n\r\n    git clone https://github.com/grueni/libqb.git\r\n\r\n[See Github](https://github.com/grueni/libqb)\r\n\r\n## Prepare the build system for Solaris 11U7\r\nInstall additional packages from the Solaris repository. The following command install all packages necessary to compile the complete Corosync suite not only Libqb.\r\n\r\n```shell\r\npkg install autoconf automake-110 gnu-m4 gettext system/header header-math libnet \\\r\n   ipmitool gnu-make developer/build/libtool library/libtool/libltdl \\\r\n   library/security/nss library/ncurses library/security/openssl text/gnu-gettext \\\r\n   system/io/infiniband/reliable-datagram-sockets-v3 library/gnutls \\\r\n   developer/versioning/mercurial git \\\r\n   data/docbook/docbook-style-xsl data/docbook/docbook-style-dsssl /data/docbook/docbook-dtds\r\n```\r\n## Prepare the build system for OpenIndiana 151a6\r\nInstall additional packages from the Solaris repository. The following command install all packages necessary to compile the complete Corosync suite not only Libqb.\r\n```shell\r\npkg install sfe/developer/gcc-46 developer/gnu-binutils \\ \r\n\trsync gnu-tar wget swig \\\r\n\tautoconf automake-110 gnu-m4 gettext system/header header-math libnet \\\r\n\tipmitool gnu-make developer/build/libtool library/libtool/libltdl \\\r\n\tlibrary/ncurses library/security/openssl text/gnu-gettext \\\r\n\tlibrary/gnutls developer/versioning/mercurial \\\r\n\tpkg://openindiana.org/developer/versioning/git \\\r\n\tSUNWcs driver/network/ofk system/header \\\r\n\tmeld developer/library/lint developer/object-file \\\r\n\tsystem/library/mozilla-nss/header-nss library/nspr/header-nspr\r\n```\r\n## Install additional packages from opencsw\r\nInstall [OpenCSW] (http://www.opencsw.org/manual/for-administrators/getting-started.html). \r\nI got an error from curl and could repair it as follows.\r\n#repair missing certificates in curl\r\n# http://openindiana.org/pipermail/userland-team/2011-September/000094.html\r\nmkdir -p /etc/curl && cat /etc/certs/CA/*.pem > /etc/curl/curlCA\r\n\r\npkgadd -d http://get.opencsw.org/now\r\n/opt/csw/bin/pkgutil -i automake autoconf libtool gsed CSWggettext pkgconfig augeas\r\n\r\n## Compile the Corosync suite\r\n\t\r\n### Environment for compiling\r\nWe install Coroync in /opt/ha. Change the PREFIX if you would like to use another location. BUILDPATH is the root folder to create the source code folders.\r\n```shell\r\nexport CFLAGS='-D__EXTENSIONS__ -D_POSIX_PTHREAD_SEMANTICS -DNAME_MAX=255 -DHOST_NAME_MAX=255 -I/usr/include -I/opt/ha/include -lsocket -lnsl'\r\nexport PREFIX=/opt/ha\r\nexport LDFLAGS='-R/usr/gnu/lib -L${PREFIX}/lib -L/usr/gnu/lib -L/lib -L/usr/lib'\r\nexport PATH=/opt/csw/bin:/usr/gnu/bin:/usr/bin:/usr/sbin:$PREFIX/bin\r\nexport LCRSODIR=/usr/libexec/lcrso \r\nexport CLUSTER_USER=hacluster\r\nexport CLUSTER_GROUP=haclient\r\nexport BUILDPATH=/export/builds3\r\n```\r\n### Packages\tto compile\r\n\r\n* [libESMTP] (http://www.stafford.uklinux.net/libesmtp/)\r\n* [Check] (http://check.sourceforge.net/)\r\n* [Reusable Cluster Components] (http://hg.linux-ha.org/glue)\r\n* The [resource-agents](https://github.com/ClusterLabs/resource-agents) from [ClusterLabs](http://www.clusterlabs.org/)\r\n* [libqb](https://github.com/asalkeld/libqb)\r\n* [libstatgrab](http://dl.ambiweb.de/mirrors/ftp.i-scream.org/libstatgrab/)\r\n* [Corosync](http://www.corosync.org/doku.php?id=welcome)\r\n* [Heartbeat](http://hg.linux-ha.org/heartbeat-STABLE_3_0)\r\n* [Pacemaker](https://github.com/beekhof/pacemaker)\r\n* [crmsh](http://savannah.nongnu.org/projects/crmsh/)\r\n\t\r\n### Compile libESMTP\r\n```shell\r\ncd $BUILDPATH\r\nexport CFLAGS='-std=c89 -D__EXTENSIONS__ -DNAME_MAX=255 -DHOST_NAME_MAX=255'\r\nwget http://www.stafford.uklinux.net/libesmtp/libesmtp-1.0.6.tar.gz\r\ngtar zxvf libesmtp-1.0.6.tar.gz\r\ncd libesmtp-1.0.6\r\nmkdir m4\r\nautoreconf -i\r\n./configure --prefix=$PREFIX \r\nperl -pi -e 's#// TODO: handle GEN_IPADD##' smtp-tls.c\r\ngmake\r\ngmake install \r\ncp auth-client.h $PREFIX/include\r\ncp auth-plugin.h $PREFIX/include\r\ncp libesmtp.h    $PREFIX/include\r\n# restore CFLAGS\r\nexport CFLAGS='-D__EXTENSIONS__ -D_POSIX_PTHREAD_SEMANTICS -DNAME_MAX=255 -DHOST_NAME_MAX=255 -I/usr/include -I$PREFIX/include -lsocket -lnsl'\r\n```\r\n### Compile Check\r\n```shell\r\ncd $BUILDPATH\r\nwget -O check-0.9.8.tar.gz http://sourceforge.net/projects/check/files/latest/download?source=files\r\ngtar zxfv check-0.9.8.tar.gz\r\ncd check-0.9.8\r\n./configure --prefix=$PREFIX \r\ngmake && gmake install\r\n# there is an error in creation of the tests, after installation the creation suceeds\r\ngmake && gmake install\r\n```\r\n\r\n### Compile Reusable Cluster Components\r\n```shell\r\ncd $BUILDPATH\r\nwget -O cluster-glue.tar.bz2 http://hg.linux-ha.org/glue/archive/tip.tar.bz2\r\ngtar jxvf cluster-glue.tar.bz2\r\ncd Reusable-Cluster-Components-*\r\nperl -pi -e 's/-Wunsigned-char//g' configure.ac\r\nperl -pi -e 's/-fstack-protector-all//g' configure.ac\r\nperl -pi -e 's#\\$\\(XSLTPROC\\) \\\\#\\$\\(XSLTPROC\\) --novalid \\\\#g' doc/Makefile.am\r\n./autogen.sh \r\n./configure --prefix=$PREFIX --enable-fatal-warnings=no --with-daemon-user=${CLUSTER_USER} --with-daemon-group=${CLUSTER_GROUP} --with-ocf-root=$PREFIX/usr/lib/ocf\r\ngmake && gmake install\r\n```\r\n\r\n### Compile resource-agents\r\n```shell\r\ncd $BUILDPATH \r\nwget -O resource-agents.tar.gz https://github.com/ClusterLabs/resource-agents/tarball/master\r\ngtar zxvf resource-agents.tar.gz\r\ncd ClusterLabs-resource-agents-*/\r\nperl -pi -e 's/unsigned-char//g' configure.ac\r\nperl -pi -e 's#\\$\\(XSLTPROC\\) \\\\#\\$\\(XSLTPROC\\) --novalid \\\\#g' doc/man/Makefile.am\r\n./autogen.sh && ./configure --prefix=$PREFIX --with-ocf-root=$PREFIX/usr/lib/ocf --enable-fatal-warnings=no\r\ngmake && gmake install \r\n```\r\n\r\n### Compile libqb\r\n```shell\r\ncd $BUILDPATH \r\nwget https://fedorahosted.org/releases/q/u/quarterback/libqb-0.14.1.tar.gz\r\ngtar xvf libqb-0.14.1.tar.gz\r\ncd libqb-0.14.1\r\nperl -pi -e 's/unsigned-char//g' configure.ac\r\nperl -pi -e 's/gnu89-inline//g' configure.ac\r\n./autogen.sh && ./configure --prefix=$PREFIX --enable-debug && gmake\r\ngmake && gmake install \r\n```\r\n\r\n### Compile libstatgrab\r\n```shell\r\ncd $BUILDPATH\r\nwget http://dl.ambiweb.de/mirrors/ftp.i-scream.org/libstatgrab/libstatgrab-0.17.tar.gz\r\ngtar zxvf libstatgrab-0.17.tar.gz\r\ncd libstatgrab-0.17\r\n./configure --prefix=$PREFIX \r\nperl -pi -e 's/libstatgrab_la_LIBADD =/libstatgrab_la_LIBADD = -lkstat -ldevinfo/g'  ./src/libstatgrab/Makefile \r\n```\r\n\r\n### Compile Corosync\r\n```shell\r\ncd $BUILDPATH\r\nwget ftp://ftp:downloads@ftp.corosync.org/downloads/corosync-2.0.1/corosync-2.0.1.tar.gz \r\ngtar zxvf corosync-2.0.1.tar.gz\r\ncd corosync-2.0.1\r\n# changed manually  exec/Makefile.am\r\n# changed manually  common_lib/Makefile.am\r\n# changed manually  lib/Makefile.am\r\nexport LIBQBLIBQB_CFLAGS=-I$PREFIX/include/qb\r\nexport LIBQB_LIBS='-R${PREFIX}/lib -L${PREFIX}/lib -lqb'\r\nexport nss_CFLAGS=-I/usr/include/mps\r\nexport nss_LIBS='-R/usr/lib/mps -L/usr/lib/mps -lnss3 -lsmime3 -lssl3 -lnssutil3 -lplds4 -lplc4 -lnspr4 -lpthread -ldl -lposix4'\r\nexport rdmacm_CFLAGS=-I/usr/include\r\nexport rdmacm_LIBS='-R/usr/lib -L/usr/lib'\r\nexport ibverbs_CFLAGS=-I/usr/include\r\nexport ibverbs_LIBS='-R/usr/lib -L/usr/lib -libverbs -lrdmacm'\r\nperl -pi -e 's/unsigned-char//g' configure.ac\r\nperl -pi -e 's/gnu89-inline//g' configure.ac\r\nperl -pi -e 's#awk#gawk#' build-aux/genman\r\nperl -pi -e 's#sed -i#gsed -i#' build-aux/genman\r\nperl -pi -e 's#sed -i#gsed -i#' init/Makefile.am\r\n# not necessary!\r\n# perl -pi -e 's#QB_IPC_SHM#QB_IPC_SOCKET#' /export/builds/corosync-2.0.1/exec/ipc_glue.c\r\n./autogen.sh && ./configure --prefix=$PREFIX --localstatedir=$PREFIX/var --enable-monitoring --enable-snmp --enable-smtp --enable-xmlconf --enable-rdma --enable-testagents --enable-augeas --enable-debug\r\ngmake clean && gmake install && chown -R hacluster:haclient $PREFIX\r\n```\r\n\r\n### Compile Heartbeat\r\n```shell\r\ncd $BUILDPATH\r\nwget http://hg.linux-ha.org/heartbeat-STABLE_3_0/archive/tip.tar.bz2\r\ngtar jxvf tip.tar.bz2\r\ncd Heartbeat-3-0-*/\r\nexport LDFLAGS='-R/usr/gnu/lib -L${PREFIX}/lib -L/usr/gnu/lib -L/lib -L/usr/lib -lsocket -lnsl'\r\n./bootstrap\r\n./configure --prefix=$PREFIX --enable-quorumd \r\ngmake\r\ngmake install\r\n```\r\n\r\n### Compile Pacemaker\r\n```shell\r\ncd $BUILDPATH\r\nmkdir pacemaker-1.1.7\r\ncd pacemaker-1.1.7\r\ngit init\r\ngit remote add -t 1.1 -f origin https://github.com/ClusterLabs/pacemaker.git\r\ngit checkout 1.1\r\n\r\nperl -pi -e 's/-Wunsigned-char//g' configure.ac\r\nperl -pi -e 's/-fstack-protector-all//g' configure.ac\r\nperl -pi -e 's#-Wno-unused-but-set-variable##' configure.ac\r\nperl -pi -e 's#stdout#stdoutx#'   include/crm/stonith-ng-internal.h\r\nperl -pi -e 's#>stdout#>stdoutx#' lib/fencing/st_client.c\r\nperl -pi -e 's#>stdout#>stdoutx#' fencing/commands.c\r\n\r\n./autogen.sh && ./configure --prefix=$PREFIX  --enable-fatal-warnings=no --with-corosync --with-snmp --with-esmtp --with-cs-quorum --with-acl=no\r\ngmake clean && gmake && gmake install && chown -R hacluster:haclient $PREFIX\r\n\r\n\r\nmkdir $PREFIX/etc/corosync/uidgid.d\r\n(\r\necho \"uidgid {\"\r\necho \"   uid: `id -u ${CLUSTER_USER}`\"\r\necho \"   gid: `id -g ${CLUSTER_USER}`\"\r\necho \"}\"\r\n) > $PREFIX/etc/corosync/uidgid.d/uid.conf\r\n```\r\n\r\n### Compile crmsh\r\n```shell\r\ncd $BUILDPATH\r\nhg clone http://hg.savannah.nongnu.org/hgweb/crmsh/\r\ncd crmsh\r\nperl -pi -e 's#ps -e -o pid,command#ps -e -o pid,comm#' ./modules/utils.py\r\nperl -pi -e 's#a2x -f manpage#a2x -L -f manpage#' doc/Makefile.am\r\n./autogen.sh && ./configure --prefix=$PREFIX  && gmake clean && gmake install\r\n# check if it works\r\nexport PYTHONPATH=${PREFIX}/lib/python2.6/site-packages\r\n${PREFIX}/sbin/crm\r\n```\r\n\r\n\r\n## How you can help\r\nIf you find this project useful, you may want to consider supporting its future development.\r\nThere are a number of ways to support the project.\r\n\r\n* Test and report issues.\r\n* Help others on the [mailing list](https://fedorahosted.org/mailman/listinfo/quarterback-devel).\r\n* Contribute documentation, examples and test cases.\r\n* Contribute patches.\r\n* Spread the word.\r\n\r\n","google":""}